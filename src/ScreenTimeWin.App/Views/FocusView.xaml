<UserControl x:Class="ScreenTimeWin.App.Views.FocusView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:ScreenTimeWin.App.ViewModels"
             xmlns:p="clr-namespace:ScreenTimeWin.App.Properties"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="{DynamicResource WindowBackgroundBrush}">
    
    <Grid Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.2*"/> <!-- Left: Timer -->
                <ColumnDefinition Width="24"/>   <!-- Gap -->
                <ColumnDefinition Width="*"/>    <!-- Right: Report & Apps -->
            </Grid.ColumnDefinitions>

            <!-- Left: Focus Mode Timer -->
            <Border Grid.Column="0" Style="{DynamicResource CardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>  <!-- Header -->
                        <RowDefinition Height="400"/>   <!-- Timer Visual -->
                        <RowDefinition Height="Auto"/>  <!-- Controls -->
                    </Grid.RowDefinitions>
                    
                    <!-- Title -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Border Width="32" Height="32" CornerRadius="8" Background="{DynamicResource AccentBrush}" Margin="0,0,12,0">
                            <TextBlock Text="ðŸŽ¯" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="{x:Static p:Resources.FocusModeTitle}" FontSize="22" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextBrush}"/>
                    </StackPanel>
                    
                    <!-- Timer Visual -->
                    <Grid Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                         <!-- Placeholder for Circular Timer -->
                         <Ellipse Width="300" Height="300" Stroke="{DynamicResource ProgressBackgroundBrush}" StrokeThickness="20"/>
                         <Ellipse Width="300" Height="300" Stroke="{DynamicResource AccentBrush}" StrokeThickness="20" StrokeDashArray="60 100" RenderTransformOrigin="0.5,0.5">
                             <Ellipse.RenderTransform>
                                 <RotateTransform Angle="-90"/>
                             </Ellipse.RenderTransform>
                         </Ellipse>
                         
                         <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                             <TextBlock Text="{Binding RemainingTimeText}" FontSize="64" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextBrush}" HorizontalAlignment="Center"/>
                             <TextBlock Text="{Binding FocusLabel}" FontSize="16" Foreground="{DynamicResource SecondaryTextBrush}" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                         </StackPanel>
                    </Grid>
                    
                    <!-- Controls -->
                    <StackPanel Grid.Row="2" Orientation="Vertical" HorizontalAlignment="Center" Margin="0,20,0,0">
                         <!-- Start/Stop Buttons -->
                         <Button Command="{Binding StartFocusCommand}" Content="{x:Static p:Resources.StartFocus}" 
                                 Visibility="{Binding IsFocusActive, Converter={StaticResource InverseBooleanConverter}}"
                                 Padding="40,16" FontSize="16" FontWeight="SemiBold" Background="{DynamicResource AccentBrush}" Foreground="White">
                             <Button.Template>
                                 <ControlTemplate TargetType="Button">
                                     <Border Background="{TemplateBinding Background}" CornerRadius="28" Padding="{TemplateBinding Padding}">
                                         <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                     </Border>
                                 </ControlTemplate>
                             </Button.Template>
                         </Button>
                                 
                         <Button Command="{Binding StopFocusCommand}" Content="{x:Static p:Resources.StopFocus}" 
                                 Visibility="{Binding IsFocusActive, Converter={StaticResource BooleanToVisibilityConverter}}"
                                 Padding="40,16" FontSize="16" FontWeight="SemiBold" Background="{DynamicResource ErrorBrush}" Foreground="White">
                             <Button.Template>
                                 <ControlTemplate TargetType="Button">
                                     <Border Background="{TemplateBinding Background}" CornerRadius="28" Padding="{TemplateBinding Padding}">
                                         <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                     </Border>
                                 </ControlTemplate>
                             </Button.Template>
                         </Button>
                                 
                         <!-- Session Count -->
                         <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                              <TextBlock Text="{x:Static p:Resources.SessionsCompleted}" Foreground="{DynamicResource SecondaryTextBrush}"/>
                              <TextBlock Text="{Binding SessionsCompletedToday}" FontWeight="Bold" Margin="8,0,0,0"/>
                         </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right: Report & Apps -->
            <StackPanel Grid.Column="2">
                 <!-- Weekly Report Card (Top Right) -->
                 <Button Command="{Binding NavigateToWeeklyReportCommand}" 
                        Padding="0" Margin="{StaticResource CardMargin}"
                        Cursor="Hand" BorderThickness="0">
                     <Button.Template>
                         <ControlTemplate TargetType="Button">
                             <Border Background="{DynamicResource AccentBrush}" CornerRadius="{StaticResource CardCornerRadius}" Padding="20">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="*"/>
                                         <ColumnDefinition Width="Auto"/>
                                     </Grid.ColumnDefinitions>
                                     <StackPanel VerticalAlignment="Center">
                                          <TextBlock Text="Weekly Insights" FontSize="18" FontWeight="Bold" Foreground="White" Margin="0,0,0,4"/>
                                          <TextBlock Text="View detailed report" FontSize="14" Foreground="#CCFFFFFF"/>
                                     </StackPanel>
                                     <TextBlock Grid.Column="1" Text="ðŸ“Š" FontSize="40" Opacity="0.3" VerticalAlignment="Center"/>
                                 </Grid>
                             </Border>
                         </ControlTemplate>
                     </Button.Template>
                </Button>

                <!-- Allowed Apps Card -->
                <Border Style="{DynamicResource CardStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                             <RowDefinition Height="Auto"/>
                             <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Text="{x:Static p:Resources.AllowedApps}" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>
                        
                        <ScrollViewer Grid.Row="1" MaxHeight="300" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding AllowedApps}">
                                 <ItemsControl.ItemTemplate>
                                     <DataTemplate>
                                         <Grid Margin="0,6">
                                              <Grid.ColumnDefinitions>
                                                  <ColumnDefinition Width="Auto"/>
                                                  <ColumnDefinition Width="*"/>
                                                  <ColumnDefinition Width="Auto"/>
                                              </Grid.ColumnDefinitions>
                                              <CheckBox IsChecked="{Binding IsSelected}" VerticalAlignment="Center"/>
                                              <TextBlock Grid.Column="1" Text="{Binding DisplayName}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                                         </Grid>
                                     </DataTemplate>
                                 </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </StackPanel>
    </Grid>
</UserControl>

