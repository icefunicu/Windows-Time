<UserControl x:Class="ScreenTimeWin.App.Views.FocusView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:ScreenTimeWin.App.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             Background="{DynamicResource WindowBackgroundBrush}">
    
    <Grid Margin="24">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1.2*"/> <!-- å·¦ä¾§ï¼šå€’è®¡æ—¶ -->
            <ColumnDefinition Width="20"/>   <!-- é—´è· -->
            <ColumnDefinition Width="*"/>    <!-- å³ä¾§ï¼šåº”ç”¨åˆ—è¡¨ -->
        </Grid.ColumnDefinitions>

        <!-- å·¦ä¾§ï¼šFocus Mode ä¸»åŒºåŸŸ -->
        <Border Grid.Column="0" Background="{DynamicResource CardBackgroundBrush}" CornerRadius="12" Padding="30">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.06" Color="#000000"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- æ ‡é¢˜ -->
                    <RowDefinition Height="*"/>     <!-- å€’è®¡æ—¶åŒºåŸŸ -->
                    <RowDefinition Height="Auto"/>  <!-- åº•éƒ¨ç»Ÿè®¡ -->
                </Grid.RowDefinitions>
                
                <!-- æ ‡é¢˜ -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                    <Border Width="28" Height="28" CornerRadius="6" Background="{DynamicResource AccentBrush}" Margin="0,0,12,0">
                        <TextBlock Text="ðŸŽ¯" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <TextBlock Text="ðŸŽ¯ ä¸“æ³¨æ¨¡å¼" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center"
                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                </StackPanel>
                
                <!-- åœ†å½¢å€’è®¡æ—¶åŒºåŸŸ -->
                <Grid Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- åœ†å½¢è¿›åº¦èƒŒæ™¯ -->
                    <Ellipse Width="220" Height="220" Stroke="{DynamicResource ProgressBackgroundBrush}" 
                             StrokeThickness="12" Fill="Transparent"/>
                    
                    <!-- åœ†å½¢è¿›åº¦æ¡ï¼ˆä½¿ç”¨Arcæ¨¡æ‹Ÿï¼‰ -->
                    <Ellipse Width="220" Height="220" StrokeThickness="12" Fill="Transparent">
                        <Ellipse.Stroke>
                            <SolidColorBrush Color="#1967D2"/>
                        </Ellipse.Stroke>
                        <Ellipse.RenderTransform>
                            <RotateTransform Angle="-90" CenterX="110" CenterY="110"/>
                        </Ellipse.RenderTransform>
                        <!-- ä½¿ç”¨StrokeDashArrayæ¨¡æ‹Ÿè¿›åº¦ -->
                        <Ellipse.StrokeDashArray>
                            <DoubleCollection>
                                <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib">5.5</sys:Double>
                                <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib">100</sys:Double>
                            </DoubleCollection>
                        </Ellipse.StrokeDashArray>
                    </Ellipse>
                    
                    <!-- å†…éƒ¨å†…å®¹ -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <TextBlock Text="{Binding RemainingTimeText}" FontSize="48" FontWeight="Bold" 
                                   HorizontalAlignment="Center" Foreground="{DynamicResource PrimaryTextBrush}"/>
                        <TextBlock Text="ä¿æŒä¸“æ³¨" FontSize="14" HorizontalAlignment="Center" 
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,4,0,0"/>
                        <TextBlock Text="{Binding FocusLabel}" FontSize="12" HorizontalAlignment="Center" 
                                   Foreground="{DynamicResource AccentBrush}" Margin="0,4,0,0"/>
                    </StackPanel>
                </Grid>
                
                <!-- æŽ§åˆ¶æŒ‰é’® -->
                <StackPanel Grid.Row="1" VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <!-- å¼€å§‹æŒ‰é’® -->
                    <Button Content="å¼€å§‹ä¸“æ³¨" Command="{Binding StartFocusCommand}" 
                            Background="#1967D2" Foreground="White" Padding="30,12" FontSize="14" FontWeight="SemiBold"
                            Visibility="{Binding IsFocusActive, Converter={StaticResource InverseBooleanConverter}}">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="24" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <!-- åœæ­¢æŒ‰é’® -->
                    <Button Content="ç»“æŸä¸“æ³¨" Command="{Binding StopFocusCommand}" 
                            Background="#D93025" Foreground="White" Padding="30,12" FontSize="14" FontWeight="SemiBold"
                            Visibility="{Binding IsFocusActive, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="24" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
                
                <!-- åº•éƒ¨ç»Ÿè®¡æ  -->
                <Border Grid.Row="2" Background="{DynamicResource WindowBackgroundBrush}" CornerRadius="8" Padding="16,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Sessions Completed -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ä»Šæ—¥å®Œæˆä¼šè¯" FontSize="13" 
                                       Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center"/>
                            <Border Background="{DynamicResource AccentBrush}" CornerRadius="10" 
                                    Padding="10,3" Margin="12,0,0,0">
                                <TextBlock Text="{Binding SessionsCompletedToday}" FontSize="12" FontWeight="SemiBold" 
                                           Foreground="White"/>
                            </Border>
                        </StackPanel>
                        
                        <!-- Do Not Disturb -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBlock Text="å‹¿æ‰°æ¨¡å¼" FontSize="13" 
                                       Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ToggleButton IsChecked="{Binding DoNotDisturb}" Width="44" Height="24">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border x:Name="border" Background="#E8EAED" CornerRadius="12" Width="44" Height="24">
                                            <Ellipse x:Name="thumb" Width="20" Height="20" Fill="White" 
                                                     HorizontalAlignment="Left" Margin="2,0,0,0">
                                                <Ellipse.Effect>
                                                    <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.3"/>
                                                </Ellipse.Effect>
                                            </Ellipse>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#1967D2"/>
                                                <Setter TargetName="thumb" Property="HorizontalAlignment" Value="Right"/>
                                                <Setter TargetName="thumb" Property="Margin" Value="0,0,2,0"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- å³ä¾§ï¼šåº”ç”¨åˆ—è¡¨ -->
        <Border Grid.Column="2" Background="{DynamicResource CardBackgroundBrush}" CornerRadius="12" Padding="0,16">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.06" Color="#000000"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Allowed Apps æ ‡é¢˜ -->
                    <RowDefinition Height="*"/>     <!-- Allowed Apps åˆ—è¡¨ -->
                    <RowDefinition Height="Auto"/>  <!-- Blocked æ ‡é¢˜ -->
                    <RowDefinition Height="Auto"/>  <!-- Blocked åˆ—è¡¨ -->
                </Grid.RowDefinitions>
                
                <!-- Allowed Apps æ ‡é¢˜ -->
                <Grid Margin="20,0,20,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="å…è®¸çš„åº”ç”¨" FontSize="15" FontWeight="SemiBold" 
                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                    <TextBlock Grid.Column="1" Text="â€º" FontSize="16" Foreground="{DynamicResource SecondaryTextBrush}" 
                               Cursor="Hand" VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Allowed Apps åˆ—è¡¨ -->
                <ItemsControl Grid.Row="1" ItemsSource="{Binding AllowedApps}" Margin="12,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="Transparent" CornerRadius="8" Padding="10,8" Margin="0,2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- å›¾æ ‡å ä½ -->
                                    <Border Width="28" Height="28" CornerRadius="6" 
                                            Background="{DynamicResource ProgressBackgroundBrush}" Margin="0,0,10,0">
                                        <TextBlock Text="ðŸ“±" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    
                                    <!-- åº”ç”¨å -->
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}" FontSize="13" 
                                               VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextBrush}"/>
                                    
                                    <!-- å‹¾é€‰çŠ¶æ€ -->
                                    <Ellipse Grid.Column="2" Width="20" Height="20" Fill="#1E8E3E" 
                                             Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- Blocked æ ‡é¢˜ -->
                <Grid Grid.Row="2" Margin="20,16,20,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="å·²å±è”½" FontSize="15" FontWeight="SemiBold" 
                               Foreground="{DynamicResource PrimaryTextBrush}"/>
                    <TextBlock Grid.Column="1" Text="â€º" FontSize="16" Foreground="{DynamicResource SecondaryTextBrush}" 
                               Cursor="Hand" VerticalAlignment="Center"/>
                </Grid>
                
                <!-- Blocked åˆ—è¡¨ -->
                <ItemsControl Grid.Row="3" ItemsSource="{Binding BlockedApps}" Margin="12,0,12,12">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="Transparent" CornerRadius="8" Padding="10,8" Margin="0,2">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- å›¾æ ‡å ä½ -->
                                    <Border Width="28" Height="28" CornerRadius="6" 
                                            Background="{DynamicResource ProgressBackgroundBrush}" Margin="0,0,10,0">
                                        <TextBlock Text="ðŸš«" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                    
                                    <!-- åº”ç”¨å -->
                                    <TextBlock Grid.Column="1" Text="{Binding DisplayName}" FontSize="13" 
                                               VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </Border>
    </Grid>
</UserControl>
