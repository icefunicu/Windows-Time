<Window x:Class="ScreenTimeWin.App.Views.AddLimitDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:p="clr-namespace:ScreenTimeWin.App.Properties"
        mc:Ignorable="d"
        Title="{x:Static p:Resources.AddLimitTitle}" 
        Height="420" Width="380"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">
    
    <!-- 主容器 -->
    <Border Background="{DynamicResource CardBackgroundBrush}" CornerRadius="16" Margin="10">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="5" Opacity="0.25" Color="Black"/>
        </Border.Effect>
        
        <Grid Margin="24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- 标题 -->
                <RowDefinition Height="*"/>     <!-- 内容 -->
                <RowDefinition Height="Auto"/>  <!-- 按钮 -->
            </Grid.RowDefinitions>
            
            <!-- 标题栏 -->
            <Grid Margin="0,0,0,20">
                <TextBlock Text="{x:Static p:Resources.AddLimitTitle}" FontSize="20" FontWeight="Bold" 
                           Foreground="{DynamicResource PrimaryTextBrush}"/>
                <Button Content="✕" Click="CloseButton_Click" HorizontalAlignment="Right" 
                        Background="Transparent" BorderThickness="0" FontSize="16"
                        Foreground="{DynamicResource SecondaryTextBrush}" Cursor="Hand" Padding="4"/>
            </Grid>
            
            <!-- 表单区 -->
            <StackPanel Grid.Row="1" VerticalAlignment="Top">
                <!-- 应用选择 -->
                <TextBlock Text="{x:Static p:Resources.SelectApp}" FontSize="13" FontWeight="Medium" 
                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,8"/>
                <ComboBox x:Name="AppComboBox" Height="40" FontSize="14" Padding="12,10"
                          DisplayMemberPath="DisplayName"/>
                
                <!-- 每日限制 -->
                <TextBlock Text="{x:Static p:Resources.DailyLimitLabel}" FontSize="13" FontWeight="Medium" 
                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,16,0,8"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Slider x:Name="LimitSlider" Minimum="5" Maximum="480" Value="60" 
                            TickFrequency="5" IsSnapToTickEnabled="True"
                            ValueChanged="LimitSlider_ValueChanged"/>
                    <TextBlock x:Name="LimitValueText" Grid.Column="1" Text="1h 0m" FontSize="14" FontWeight="Medium"
                               Foreground="{DynamicResource PrimaryTextBrush}" Margin="12,0,0,0" VerticalAlignment="Center" Width="60"/>
                </Grid>
                
                <!-- 宵禁模式 -->
                <Grid Margin="0,20,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel>
                        <TextBlock Text="{x:Static p:Resources.CurfewMode}" FontSize="14" FontWeight="Medium" 
                                   Foreground="{DynamicResource PrimaryTextBrush}"/>
                        <TextBlock Text="{x:Static p:Resources.CurfewModeHint}" FontSize="12" 
                                   Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,2,0,0"/>
                    </StackPanel>
                    <ToggleButton x:Name="CurfewToggle" Grid.Column="1" IsChecked="False" Width="48" Height="28">
                        <ToggleButton.Template>
                            <ControlTemplate TargetType="ToggleButton">
                                <Border x:Name="border" Background="#E8EAED" CornerRadius="14" Width="48" Height="28">
                                    <Ellipse x:Name="thumb" Width="24" Height="24" Fill="White" HorizontalAlignment="Left" Margin="2,0,0,0">
                                        <Ellipse.Effect>
                                            <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.2"/>
                                        </Ellipse.Effect>
                                    </Ellipse>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentBrush}"/>
                                        <Setter TargetName="thumb" Property="HorizontalAlignment" Value="Right"/>
                                        <Setter TargetName="thumb" Property="Margin" Value="0,0,2,0"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ToggleButton.Template>
                    </ToggleButton>
                </Grid>
                
                <!-- 宵禁时间选择器 (可折叠) -->
                <StackPanel x:Name="CurfewTimePanel" Margin="0,12,0,0" Visibility="Collapsed">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="{x:Static p:Resources.From}" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,4"/>
                            <ComboBox x:Name="CurfewStartCombo" Height="36" FontSize="13"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="{x:Static p:Resources.To}" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,4"/>
                            <ComboBox x:Name="CurfewEndCombo" Height="36" FontSize="13"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </StackPanel>
            
            <!-- 按钮区 -->
            <StackPanel Grid.Row="2" Margin="0,16,0,0">
                <Button x:Name="SaveButton" Content="{x:Static p:Resources.Save}" Click="SaveButton_Click"
                        Background="{DynamicResource AccentBrush}" Foreground="White" FontSize="14" FontWeight="SemiBold"
                        Padding="0,14" Cursor="Hand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Opacity" Value="0.9"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</Window>
